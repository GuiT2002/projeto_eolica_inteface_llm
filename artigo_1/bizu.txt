# Configuração de Cluster Dask

Este documento reúne todas as informações, comandos e comentários necessários para configurar um cluster Dask. Ele abrange a configuração do **scheduler** (máquina principal) e das **máquinas workers** (contribuidoras), além de incluir comandos para verificar os recursos disponíveis em cada máquina e dicas para garantir que todos os módulos necessários estejam acessíveis.

---

## 1. Scheduler (Máquina Principal)

### 1.1. Ativar o Ambiente Virtual (se necessário)
Se você utiliza um ambiente virtual, ative-o com o comando:
```bash
source /caminho/para/venv/bin/activate

    Comentário: Esse passo garante que o ambiente Python utilizado tenha todas as dependências necessárias para rodar o scheduler.

1.2. Iniciar o Scheduler

Execute o comando abaixo para iniciar o scheduler:

dask-scheduler

    Comentário: Após iniciar o scheduler, ele exibirá um endereço (por exemplo, tcp://192.168.1.8:8786). Esse endereço será utilizado pelos workers para se conectarem ao scheduler.

2. Workers (Máquinas Contribuidoras)
2.1. Ativar o Ambiente Virtual (se necessário)

Em cada máquina que atuará como worker, ative o ambiente virtual:

source /caminho/para/venv/bin/activate

    Comentário: Assim como no scheduler, isso garante que o ambiente Python do worker possua todas as dependências corretas.

2.2. Verificar os Recursos da Máquina
2.2.1. Informações sobre a CPU

    Para obter informações detalhadas sobre a CPU (número de núcleos, threads, etc.):

lscpu

Para uma contagem simples de núcleos:

    nproc

    Comentário: Esses comandos ajudam a determinar quantos threads ou núcleos podem ser alocados ao worker.

2.2.2. Verificar Memória Disponível

    Para verificar a quantidade de memória disponível:

    free -h

    Comentário: Esse comando mostra a memória total, utilizada e livre, permitindo definir um limite de memória adequado para o worker.

2.2.3. Verificar Limites do Sistema

    Para conferir outros limites do sistema, como o número máximo de arquivos abertos:

    ulimit -a

    Comentário: Conhecer os limites do sistema pode ser útil para ajustar a configuração dos workers e evitar problemas de recursos esgotados.

2.3. Iniciar o Worker

Com base nas informações coletadas, inicie o worker utilizando o comando:

dask-worker tcp://192.168.1.8:8786 --nworkers auto --nthreads <NUM_THREADS> --memory-limit <MEM_LIMIT>

    <NUM_THREADS>: Substitua pelo número de threads (ou núcleos) que você deseja alocar para o worker (obtido via lscpu ou nproc).
    <MEM_LIMIT>: Defina o limite de memória apropriado (por exemplo, 8GB), conforme obtido pelo comando free -h.

    Comentário: Esse comando conecta o worker ao scheduler e configura o uso máximo dos recursos da máquina.

3. Dicas Adicionais e Upload de Arquivos
3.1. Consistência dos Ambientes

    Importante: Garanta que todas as máquinas (scheduler e workers) estejam utilizando o mesmo ambiente Python, com as mesmas versões de pacotes e dependências (como Dask, DEAP, NumPy, etc.).

    Comentário: A consistência dos ambientes evita erros de deserialização e problemas de importação de módulos entre diferentes nós do cluster.

3.2. Upload de Arquivos para os Workers

Se o seu código depende de módulos específicos (por exemplo, iea37_aepcalc) que não estão instalados em todos os workers, adicione o upload do arquivo no início do seu script principal, logo após criar o client:

from dask.distributed import Client

client = Client("tcp://192.168.1.8:8786")
client.upload_file('caminho/para/iea37_aepcalc.py')

    Comentário: Esse comando distribui o arquivo necessário para os workers, garantindo que eles possam importar o módulo durante a execução das tarefas.

3.3. Monitoramento do Cluster

    A interface web do Dask, geralmente disponível em:

    http://<IP_do_scheduler>:8787

    permite que você monitore os workers, as tarefas e o desempenho geral do cluster.

    Comentário: A interface web é uma ferramenta útil para identificar gargalos, monitorar a carga e verificar se todos os workers estão funcionando corretamente.

4. Resumo dos Comandos
No Scheduler (Máquina Principal)

    Ativar o ambiente virtual (se necessário):

source /caminho/para/venv/bin/activate

Iniciar o scheduler:

    dask-scheduler

Nas Máquinas Workers (Contribuidoras)

    Ativar o ambiente virtual (se necessário):

source /caminho/para/venv/bin/activate

Verificar os recursos:

    CPU:

lscpu
nproc

Memória:

free -h

Limites do sistema:

    ulimit -a

Iniciar o worker (exemplo):

    dask-worker tcp://192.168.1.8:8786 --nworkers auto --nthreads <NUM_THREADS> --memory-limit <MEM_LIMIT>

Upload de Arquivos para os Workers (no Script Principal)

from dask.distributed import Client

client = Client("tcp://192.168.1.8:8786")
client.upload_file('caminho/para/iea37_aepcalc.py')